{"version":3,"file":"data.js","sourceRoot":"","sources":["../../src/db/data.ts"],"names":[],"mappings":"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","sourcesContent":["import { adjectives, animals, Config, uniqueNamesGenerator } from 'unique-names-generator';\r\n\r\nimport { User } from '../ts';\r\nimport DB from './DB';\r\n\r\nexport function generateUsername(callback: (username: string) => void) {\r\n    let username = uniqueNamesGenerator({\r\n        dictionaries: [adjectives, animals],\r\n        separator: '',\r\n        style: 'capital',\r\n        length: 2\r\n    });\r\n\r\n    DB.users.find({\r\n        username: username,\r\n    }).then((docs: User[]) => {\r\n        if (docs.length > 0) {\r\n            generateUsername(callback);\r\n        } else {\r\n            callback(username);\r\n        }\r\n    });\r\n};\r\n\r\nexport function registerUser(user_id: string, callback: (res: User | Error) => void) {\r\n    DB.users.find({\r\n        user_id: user_id\r\n    })\r\n        .then(docs => {\r\n            if (docs.length > 0) {\r\n                callback(docs[0]);\r\n            } else {\r\n                generateUsername(username => {\r\n                    DB.users.insert({\r\n                        user_id: user_id,\r\n                        username: username,\r\n                    })\r\n                        .then(callback)\r\n                        .catch(console.error);\r\n                });\r\n            }\r\n        })\r\n        .catch(console.error);\r\n}\r\n\r\nexport function setUsername(user: User, callback: (res: User | Error) => void) {\r\n    if (user.username === '') callback(Error(\"Username cannot be empty!\"));\r\n\r\n    DB.users.find({\r\n        username: user.username\r\n    })\r\n        .then((docs: User[]) => {\r\n            if (docs.length > 0) {\r\n                callback(Error(\"Username is taken! \" + docs[0].username))\r\n            } else {\r\n                DB.users.findOneAndUpdate(\r\n                    {user_id: user.user_id},\r\n                    {$set: {username: user.username}}\r\n                )\r\n                    .then(callback)\r\n                    .catch(console.error);\r\n            }\r\n        })\r\n        .catch(console.error);\r\n}\r\n\r\nexport function getUserByName(username: string, callback: (user: User) => void) {\r\n    DB.users.findOne({\r\n        username: username\r\n    })\r\n        .then(callback)\r\n        .catch(console.error);\r\n}\r\n\r\nexport function getUsersByName(usernames: string[], callback: (users: User[]) => void) {\r\n    if (usernames.length === 0) {\r\n        console.log('getUsersByName called on empty array!');\r\n        callback([]);\r\n    }\r\n\r\n    DB.users.find({\r\n        $or: usernames.reduce((acc: Partial<User>[], cur: string) => {\r\n            acc.push({\r\n                username: cur\r\n            });\r\n\r\n            return acc;\r\n        }, [])\r\n    })\r\n        .then(callback)\r\n        .catch(console.error);\r\n}"]}